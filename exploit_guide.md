# Guía de desarrollo de exploits para el NEO

## Plantilla de exploit y storages
Los exploits del neo siempre deben estar escritos en base a la siguiente plantilla, con las modificaciones necesarias para cada CTF:
```python
#!/usr/bin/python3
import re
import sys
import time
import requests
import json

from pwn import *

GAME_URL = "http://10.10.0.1:8081"
TEAM_ID = sys.argv[1].split(".")[2] # 10.60.18.1 => 18


SERVICE = f"CApp" # (get from http://10.10.0.1:8081/)


def getFlagStorages():
    while True:
        try:
            r = requests.get(GAME_URL + f"/flagIds?service={SERVICE}&team={TEAM_ID}")
            resp_json = r.json()
        except:
            time.sleep(0.5)
            continue
        break

    return resp_json


storages = []
json_blob = getFlagStorages()
for storage_round in json_blob[SERVICE][TEAM_ID]:
    storages.append(json_blob[SERVICE][TEAM_ID][storage_round])
## EXPLOIT STARTS HERE

for storage in storages:
    #...
```

De cada servicio se pueden obtener varias flags por medio de los storages, como ejemplo una sqli que permite leer la base de datos puede tener flags en varios ids, esos ids se dan en cada tick para cada equipo. Por esto es muy importante que los exploits utilicen la info dada en los storages. 
> **Importante**: La unica salida del exploit deben ser las flags, una por linea.


## Test del exploit
Por lo general existe el NOP team que tiene los servicios sin parchear, para probar los exploits lo mejor es atacarlos a ellos. Dos cosas importantes, un exploit que funcione para el NOP no tiene porque funcionar para los demas equipos y las flags de NOP no cuentan nada pero se pueden subir para comprobar que todo va correctamente.

## Subir exploits al NEO
Una vez que el exploit es funcional se puede subir al neo para empezar a atacar a los demas equipos. Los exploits se añaden al neo con el comando:
```
./neo_client add RUTA_EXPLOIT
```
> **Importante**: los nombres de los exploits deben de identificar tanto el servicio como la vulnerabilidad que explotant `SERVICIO-VULN.py`

Esto se ejecuta sin cerrar la terminal que esta corriendo el neo, se hace en otra terminal. Si no se sabe con seguridad que el exploit va a funcionar en un número aceptable de equipos se puede usar la opción `single`, con esto lanzamos una unica vez el exploit, si todo va bien se añade el exploit de forma permanente, esto es muy importante de cara a ahorrar recursos. A veces el neo dara un warning porque falta un fflush en principio se puede ignorar.

> **Importante**: si se sube un exploit con el nombre de uno que ya existe se reemplazara, esto es util para actualizar exploits, pero puede llevar a sustituir exploits funcionales.

## Exploits obsoletos
Cuando un exploit deja de funcionar se puede deshabilitar con `./neo_client disable ID` y habilitar con `./neo_client enable ID`.